-- Enable UUID extension
CREATE EXTENSION IF NOT EXISTS "uuid-ossp";

-- Create payments table
CREATE TABLE payments (
    id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
    engagement_id UUID NOT NULL,
    engagement_ref TEXT NOT NULL,
    operation_id UUID NOT NULL,
    operation_name TEXT NOT NULL,
    amount DECIMAL(15,2) NOT NULL,
    request_date DATE NOT NULL,
    payment_date DATE,
    status TEXT NOT NULL CHECK (status IN ('pending', 'approved', 'rejected', 'paid')),
    beneficiary TEXT NOT NULL,
    description TEXT NOT NULL,
    created_at TIMESTAMP WITH TIME ZONE DEFAULT TIMEZONE('utc'::text, NOW()) NOT NULL
);

-- Create payment_requests table
CREATE TABLE payment_requests (
    id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
    engagement_id UUID NOT NULL,
    engagement_ref TEXT NOT NULL,
    program_name TEXT NOT NULL,
    operation_name TEXT NOT NULL,
    amount DECIMAL(15,2) NOT NULL,
    frequency TEXT NOT NULL CHECK (frequency IN ('monthly', 'quarterly', 'annual')),
    start_date DATE NOT NULL,
    request_date DATE NOT NULL,
    approved_date DATE,
    status TEXT NOT NULL CHECK (status IN ('pending_officer', 'pending_accountant', 'approved', 'rejected')),
    requested_by TEXT NOT NULL,
    beneficiary TEXT NOT NULL,
    description TEXT NOT NULL,
    created_at TIMESTAMP WITH TIME ZONE DEFAULT TIMEZONE('utc'::text, NOW()) NOT NULL
);

-- Insert test data into payments table (10 records)
INSERT INTO payments (
    id, engagement_id, engagement_ref, operation_id, operation_name, 
    amount, request_date, payment_date, status, beneficiary, description
) VALUES
    (uuid_generate_v4(), uuid_generate_v4(), 'ENG/2023/001', uuid_generate_v4(), 'Construction École Primaire de Koné', 
     35000000, '2023-05-10', '2023-05-20', 'paid', 'Entreprise ABC Construction', 'Premier paiement pour travaux de fondation'),
    (uuid_generate_v4(), uuid_generate_v4(), 'ENG/2023/001', uuid_generate_v4(), 'Construction École Primaire de Koné', 
     45000000, '2023-07-15', '2023-07-30', 'paid', 'Entreprise ABC Construction', 'Deuxième paiement pour travaux de structure'),
    (uuid_generate_v4(), uuid_generate_v4(), 'ENG/2023/008', uuid_generate_v4(), 'Équipement Hôpital Central', 
     40000000, '2023-06-05', '2023-06-18', 'paid', 'MedEquip International', 'Paiement pour fourniture d''équipements médicaux'),
    (uuid_generate_v4(), uuid_generate_v4(), 'ENG/2023/012', uuid_generate_v4(), 'Rénovation Route Nationale 1', 
     60000000, '2023-08-10', '2023-08-28', 'paid', 'Routes & Ponts SA', 'Premier paiement pour travaux de terrassement'),
    (uuid_generate_v4(), uuid_generate_v4(), 'ENG/2023/001', uuid_generate_v4(), 'Construction École Primaire de Koné', 
     15000000, '2023-09-20', NULL, 'approved', 'Entreprise ABC Construction', 'Troisième paiement pour travaux de finition'),
    (uuid_generate_v4(), uuid_generate_v4(), 'ENG/2023/025', uuid_generate_v4(), 'Formation des Enseignants', 
     18000000, '2023-10-05', NULL, 'pending', 'Institut de Formation Pédagogique', 'Paiement pour services de formation'),
    (uuid_generate_v4(), uuid_generate_v4(), 'ENG/2023/030', uuid_generate_v4(), 'Campagne de Vaccination', 
     25000000, '2023-09-15', NULL, 'rejected', 'Santé Pour Tous', 'Paiement pour vaccins et matériel médical'),
    (uuid_generate_v4(), uuid_generate_v4(), 'ENG/2023/012', uuid_generate_v4(), 'Rénovation Route Nationale 1', 
     35000000, '2023-10-10', NULL, 'pending', 'Routes & Ponts SA', 'Deuxième paiement pour travaux de revêtement'),
    (uuid_generate_v4(), uuid_generate_v4(), 'ENG/2023/035', uuid_generate_v4(), 'Programme d''Alimentation Scolaire', 
     28000000, '2023-11-01', '2023-11-15', 'paid', 'AgroFood Services', 'Paiement pour fourniture de repas scolaires'),
    (uuid_generate_v4(), uuid_generate_v4(), 'ENG/2023/040', uuid_generate_v4(), 'Installation Système d''Irrigation', 
     42000000, '2023-11-15', NULL, 'approved', 'IrrigationTech SA', 'Paiement pour installation du système d''irrigation');

-- Insert test data into payment_requests table (20 records)
INSERT INTO payment_requests (
    id, engagement_id, engagement_ref, program_name, operation_name, 
    amount, frequency, start_date, request_date, approved_date, 
    status, requested_by, beneficiary, description
) VALUES
    (uuid_generate_v4(), uuid_generate_v4(), 'ENG/2023/001', 'Programme Éducation', 'Construction École Primaire de Koné', 
     35000000, 'monthly', '2023-05-01', '2023-05-10', '2023-05-15', 
     'approved', 'John Doe', 'Entreprise ABC Construction', 'Premier paiement pour travaux de fondation'),
    (uuid_generate_v4(), uuid_generate_v4(), 'ENG/2023/008', 'Programme Santé', 'Équipement Hôpital Central', 
     40000000, 'quarterly', '2023-06-01', '2023-06-05', '2023-06-10', 
     'approved', 'Jane Smith', 'MedEquip International', 'Paiement pour fourniture d''équipements médicaux'),
    (uuid_generate_v4(), uuid_generate_v4(), 'ENG/2023/012', 'Programme Infrastructures', 'Rénovation Route Nationale 1', 
     60000000, 'annual', '2023-08-01', '2023-08-10', NULL, 
     'pending_officer', 'Mike Johnson', 'Routes & Ponts SA', 'Premier paiement pour travaux de terrassement'),
    (uuid_generate_v4(), uuid_generate_v4(), 'ENG/2023/025', 'Programme Éducation', 'Formation des Enseignants', 
     18000000, 'quarterly', '2023-10-01', '2023-10-05', NULL, 
     'pending_accountant', 'Sarah Wilson', 'Institut de Formation Pédagogique', 'Paiement pour services de formation'),
    (uuid_generate_v4(), uuid_generate_v4(), 'ENG/2023/030', 'Programme Santé', 'Campagne de Vaccination', 
     25000000, 'monthly', '2023-09-01', '2023-09-15', NULL, 
     'rejected', 'David Brown', 'Santé Pour Tous', 'Paiement pour vaccins et matériel médical'),
    (uuid_generate_v4(), uuid_generate_v4(), 'ENG/2023/035', 'Programme Alimentation', 'Programme d''Alimentation Scolaire', 
     28000000, 'monthly', '2023-11-01', '2023-11-01', '2023-11-10', 
     'approved', 'Emma Davis', 'AgroFood Services', 'Paiement pour fourniture de repas scolaires'),
    (uuid_generate_v4(), uuid_generate_v4(), 'ENG/2023/040', 'Programme Agriculture', 'Installation Système d''Irrigation', 
     42000000, 'quarterly', '2023-11-15', '2023-11-15', NULL, 
     'pending_officer', 'Robert Wilson', 'IrrigationTech SA', 'Paiement pour installation du système d''irrigation'),
    (uuid_generate_v4(), uuid_generate_v4(), 'ENG/2023/045', 'Programme Éducation', 'Construction Bibliothèque Municipale', 
     55000000, 'annual', '2023-12-01', '2023-12-01', NULL, 
     'pending_accountant', 'Sophie Martin', 'Bibliothèque Plus SA', 'Paiement pour construction de la bibliothèque'),
    (uuid_generate_v4(), uuid_generate_v4(), 'ENG/2023/050', 'Programme Santé', 'Équipement Centre de Santé Rural', 
     32000000, 'quarterly', '2023-12-15', '2023-12-15', NULL, 
     'pending_officer', 'Pierre Dubois', 'MedRural Services', 'Paiement pour équipement médical'),
    (uuid_generate_v4(), uuid_generate_v4(), 'ENG/2023/055', 'Programme Infrastructures', 'Construction Pont Rural', 
     48000000, 'annual', '2024-01-01', '2024-01-01', NULL, 
     'pending_accountant', 'Marie Laurent', 'Ponts & Routes SA', 'Paiement pour construction du pont'),
    (uuid_generate_v4(), uuid_generate_v4(), 'ENG/2023/060', 'Programme Éducation', 'Formation Professionnelle', 
     22000000, 'monthly', '2024-01-15', '2024-01-15', NULL, 
     'pending_officer', 'Thomas Bernard', 'FormPro Institute', 'Paiement pour formation professionnelle'),
    (uuid_generate_v4(), uuid_generate_v4(), 'ENG/2023/065', 'Programme Santé', 'Programme de Prévention SIDA', 
     30000000, 'quarterly', '2024-02-01', '2024-02-01', NULL, 
     'pending_accountant', 'Claire Moreau', 'SantéPlus NGO', 'Paiement pour programme de prévention'),
    (uuid_generate_v4(), uuid_generate_v4(), 'ENG/2023/070', 'Programme Agriculture', 'Distribution Semences', 
     15000000, 'annual', '2024-02-15', '2024-02-15', NULL, 
     'pending_officer', 'Lucas Petit', 'AgroDistrib SA', 'Paiement pour distribution de semences'),
    (uuid_generate_v4(), uuid_generate_v4(), 'ENG/2023/075', 'Programme Éducation', 'Construction Collège', 
     75000000, 'annual', '2024-03-01', '2024-03-01', NULL, 
     'pending_accountant', 'Julie Martin', 'ÉducationPlus SA', 'Paiement pour construction du collège'),
    (uuid_generate_v4(), uuid_generate_v4(), 'ENG/2023/080', 'Programme Santé', 'Équipement Laboratoire', 
     45000000, 'quarterly', '2024-03-15', '2024-03-15', NULL, 
     'pending_officer', 'Marc Laurent', 'LabTech International', 'Paiement pour équipement de laboratoire'),
    (uuid_generate_v4(), uuid_generate_v4(), 'ENG/2023/085', 'Programme Infrastructures', 'Rénovation Marché Central', 
     38000000, 'annual', '2024-04-01', '2024-04-01', NULL, 
     'pending_accountant', 'Sophie Dubois', 'MarchéPlus SA', 'Paiement pour rénovation du marché'),
    (uuid_generate_v4(), uuid_generate_v4(), 'ENG/2023/090', 'Programme Éducation', 'Programme d''Alphabétisation', 
     20000000, 'monthly', '2024-04-15', '2024-04-15', NULL, 
     'pending_officer', 'Paul Bernard', 'AlphabétisationPlus', 'Paiement pour programme d''alphabétisation'),
    (uuid_generate_v4(), uuid_generate_v4(), 'ENG/2023/095', 'Programme Santé', 'Campagne de Vaccination COVID-19', 
     35000000, 'quarterly', '2024-05-01', '2024-05-01', NULL, 
     'pending_accountant', 'Marie Moreau', 'VaccinPlus SA', 'Paiement pour campagne de vaccination'),
    (uuid_generate_v4(), uuid_generate_v4(), 'ENG/2023/100', 'Programme Agriculture', 'Installation Système d''Irrigation', 
     28000000, 'annual', '2024-05-15', '2024-05-15', NULL, 
     'pending_officer', 'Thomas Laurent', 'IrrigationPlus SA', 'Paiement pour système d''irrigation'),
    (uuid_generate_v4(), uuid_generate_v4(), 'ENG/2023/105', 'Programme Éducation', 'Construction École Maternelle', 
     42000000, 'annual', '2024-06-01', '2024-06-01', NULL, 
     'pending_accountant', 'Claire Martin', 'ÉducationMaternelle SA', 'Paiement pour construction école maternelle'),
    (uuid_generate_v4(), uuid_generate_v4(), 'ENG/2023/110', 'Programme Santé', 'Équipement Centre de Dialyse', 
     65000000, 'quarterly', '2024-06-15', '2024-06-15', NULL, 
     'pending_officer', 'Lucas Dubois', 'DialysePlus SA', 'Paiement pour équipement de dialyse'); 