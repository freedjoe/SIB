# Product Requirements Document (PRD) - SIGB

## 1. Introduction

SIGB est une application web moderne pour la gestion budg√©taire et financi√®re. L'application sera d√©velopp√©e avec **React 19**, **ShadCN UI**, **Tailwind CSS**, et int√©gr√©e avec **Supabase** pour la base de donn√©es et l'authentification.

## 2. Technologies Utilis√©es

- **Front-end** : React 19, Vite, TypeScript, ShadCN UI, Tailwind CSS
- **Back-end** : Supabase (PostgreSQL, Auth, Storage)
- **UI/UX** : Dark/Light mode, Responsive (Desktop, Tablet, Mobile)
- **i18n** : Support multilingue (AR, EN, FR)
- **DevOps** : Supabase direct connection, environnement s√©curis√© avec `.env`

---

## 3. Authentification & S√©curit√©

- **Login / Signup** : Int√©gration avec Supabase Auth
- **Forgot Password** : Formulaire de r√©cup√©ration
- **JWT Tokens** : Stockage s√©curis√©
- **Roles & Permissions** : Admin, Utilisateur
- **Test** : Utilisateur par d√©faut `admin/admin`

---

## 4. Interface Utilisateur

### 4.1. Layout Principal

- **Top bar** :

  - Avatar utilisateur avec menu (Profil, Param√®tres, Aide, D√©connexion)
  - Boutons : Notifications, Recherche globale, Mode Sombre/Clair, S√©lecteur de langue (AR, EN, FR)

- **Menu lat√©ral** :
  - Dashboard
  - Budgets
  - Programmes
  - Portefeuilles
  - Actions
  - Op√©rations
  - Engagements
  - Paiements
  - Rapports
  - Contr√¥les & Audits
  - Param√®tres

---

## 5. Fonctionnalit√©s D√©tail√©es

### 5.1. Dashboard

- Ex√©cution du budget : **Mensuel, Trimestriel, Annuel**
- R√©partition par **Portefeuille de programme** et **Ministres**
- Allocation par programme
- Approbations en attente
- Activit√©s r√©centes

### 5.2. Budgets

- Actions : **Voir, √âditer, Supprimer, Ajouter** (Fen√™tre Modal)
- Onglets : **Aper√ßu, Pr√©vision, Allocation, Historique**

### 5.3. Programmes

- R√©organisation des onglets (**Portefeuilles apr√®s Programmes**)
- Actions : **Voir, √âditer, Supprimer, Ajouter** (Fen√™tre Modal)
- D√©tails d'un programme : **Popup avec d√©tails, actions et op√©rations**

### 5.4. Portefeuilles

- Actions : **Voir, √âditer, Supprimer, Ajouter** (Fen√™tre Modal)
- **Voir un portefeuille** : Redirige vers **Programmes** avec filtre appliqu√©

### 5.5. Actions

- Table : `action_id (PK), programme_id (FK), nom, type_action, montant_allou√©`
- Actions : **Voir, √âditer, Supprimer, Ajouter** (Fen√™tre Modal)
- Voir les d√©tails : **Popup avec op√©rations li√©es**

### 5.6. Op√©rations

- Actions : **Voir, √âditer, Supprimer, Ajouter** (Fen√™tre Modal)

### 5.7. Engagements

- Onglets : **Liste des Engagements, Approbations en Attente**
- Engagements : `operation, b√©n√©ficiaire, montant demand√©, montant approuv√©, statut`
- Approbations : `priorit√©, d√©tail engagement, demand√© par, montant, date`
- Actions : **Voir, √âditer, Supprimer, Ajouter** (Fen√™tre Modal)

### 5.8. Paiements

- Actions : **Voir, √âditer, Supprimer, Ajouter** (Fen√™tre Modal)

### 5.9. Rapports

- Rapport d'Ex√©cution Budg√©taire (**Quotidien**)
- Rapport d'Allocation par Minist√®re (**Hebdomadaire**)
- Rapport Financier Annuel
- Ex√©cution Budg√©taire (**Mensuel, Trimestriel, Annuel**)
- R√©partition Budg√©taire par Minist√®re

### 5.10. Contr√¥les & Audits

- **Rapport des Contr√¥les Financiers** : `date, type de contr√¥le, entit√©, contr√¥leur, r√©sultat`
- **Logs d'audit**
- Actions : **Voir, √âditer, Supprimer, Ajouter** (Fen√™tre Modal)

### 5.11. Param√®tres

- **Basic Data** : Minist√®res, Utilisateurs, R√¥les
- **Profil utilisateur** : Modifier profil et changer mot de passe
- **Aide & Support**
- **Conditions G√©n√©rales**

---

## 6. Design & Exp√©rience Utilisateur

- **Mode Sombre/Clair** avec **bouton de bascule**
- **Menu langues** avec **drapeaux (üá©üáø üá∫üá∏ üá´üá∑)**
- **UI moderne avec ShadCN et Tailwind**
- **Exp√©rience fluide sur Desktop, Tablet, Mobile**

---

## 7. Tests & Validation

- Cr√©ation de **10 enregistrements par table** pour tester
- V√©rification de **tous les boutons, actions et fen√™tres modales**
- Test des **requ√™tes Supabase (CRUD)**
- **D√©ploiement sur Vercel ou autre plateforme**

---

## 8. Base de Donn√©es (Supabase)

### Connexion :

```
POSTGRESQL_URL=postgresql://postgres:Admin@2014@db.iubymohnsgnmmxncroqs.supabase.co:5432/postgres
```

### Variables d'environnement :

```
REACT_APP_SUPABASE_URL=https://iubymohnsgnmmxncroqs.supabase.co
REACT_APP_SUPABASE_ANON_KEY=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFz...
```

---

## 9. D√©ploiement & H√©bergement

- **Utilisation de Vercel** pour le front-end
- **Base de donn√©es Supabase h√©berg√©e**
- **Configuration CI/CD** avec GitHub Actions

---

## 10. Roadmap

‚úÖ Initialisation du projet (React 19 + ShadCN + Tailwind)
‚úÖ Configuration de Supabase (DB, Auth, Storage)
‚úÖ Cr√©ation des interfaces UI/UX
üöß D√©veloppement des modules
üöß Tests et validation
üöß D√©ploiement final

---

## 11. Am√©liorations Futures

- **Dashboard interactif avec Graphs & Stats**
- **Mode offline avec IndexedDB**
- **Automatisation des rapports**

---

üéØ **SIGB sera une plateforme moderne, fluide et intuitive pour la gestion budg√©taire et financi√®re !** üöÄ
3.5. Commitments Module
Commitment Table: Requested amount, approved amount, status

Add a Commitment:

Select a Program

Enter requested amount

Workflow approval process

Detailed View: Modal showing historical records and associated documents

Approval by Officer: The officer approves or rejects the commitments

Budget Allocation Check: Automatic check for budget availability before approval

3.6. Payment Module
Payment Table: Displays liquidated and paid commitments

Payment Validation: Multi-level workflow (payment order, verification, final approval)

PDF Export: Report of payments made

Payment Request:

Submit payment requests for due claims, with the option to choose the frequency (monthly, quarterly, annually)

Requests are allocated from the available payment credit, with consumption tracking

3.7. Reports Module
List of Generated Reports: Executed budget, Allocation by ministry

Advanced Filters: Date, Category, Ministry, Payment status

Export to Excel/PDF

Performance Reports: Financial indicators and analysis of budget vs. actual spending discrepancies

3.8. Settings & Administration
User Management: Add, Delete, Assign roles

Roles: Administrator, Officer, Accountant, Standard user

Permissions: Define allowed actions per role (CRUD on budgets, payments, commitments, reports)

System Configuration: Budget period, Currency

Logs & Audit: User action history (create, modify, delete)

Payment Credit Management: Track available credits for payment requests

3.9. Officer & Accountant Module
Submit Payment Requests:

Officers and accountants can submit monthly, quarterly, or annual payment requests for payments to be made. They can specify the amount to be allocated and the frequency.

Each payment request is validated against the available budget and payment credit.

Integrated payment validation workflow (validation by officer and then by accountant).

Track Payment Requests:

Track the status of requests (Pending, Approved, Rejected).

Automatic notifications for actions required at each step of the validation process.

3.5. Commitments Module
Commitment Table: Requested amount, approved amount, status

Add a Commitment:

Select a Program

Enter requested amount

Workflow approval process

Detailed View: Modal showing historical records and associated documents

Approval by Officer: The officer approves or rejects the commitments

Budget Allocation Check: Automatic check for budget availability before approval

3.6. Payment Module
Payment Table: Displays liquidated and paid commitments

Payment Validation: Multi-level workflow (payment order, verification, final approval)

PDF Export: Report of payments made

Payment Request:

Submit payment requests for due claims, with the option to choose the frequency (monthly, quarterly, annually)

Requests are allocated from the available payment credit, with consumption tracking

3.7. Reports Module
List of Generated Reports: Executed budget, Allocation by ministry

Advanced Filters: Date, Category, Ministry, Payment status

Export to Excel/PDF

Performance Reports: Financial indicators and analysis of budget vs. actual spending discrepancies

3.8. Settings & Administration
User Management: Add, Delete, Assign roles

Roles: Administrator, Officer, Accountant, Standard user

Permissions: Define allowed actions per role (CRUD on budgets, payments, commitments, reports)

System Configuration: Budget period, Currency

Logs & Audit: User action history (create, modify, delete)

Payment Credit Management: Track available credits for payment requests

3.9. Officer & Accountant Module
Submit Payment Requests:

Officers and accountants can submit monthly, quarterly, or annual payment requests for payments to be made. They can specify the amount to be allocated and the frequency.

Each payment request is validated against the available budget and payment credit.

Integrated payment validation workflow (validation by officer and then by accountant).

Track Payment Requests:

Track the status of requests (Pending, Approved, Rejected).

Automatic notifications for actions required at each step of the validation process.

3.10. Module: Pr√©visions des D√©penses - CP √† Mobiliser
Overview: This module allows users to forecast the expenses required to mobilize specific amounts of Credits de Paiement (CP). It enables better planning and tracking of funds that are forecasted but not yet mobilized.

Actions:

Add Forecasted Expense: Modal with a form to create a new forecasted expense entry. (Fields: Program Name, Forecasted Amount, Period, Ministry, Category)

Edit Forecasted Expense: Edit button with pre-filled fields to update the details of the forecasted expense.

Delete Forecasted Expense: Delete button with confirmation to remove a forecasted expense entry.

Forecast Display:

Monthly/Quarterly/Annually: Ability to forecast expenditures based on time periods.

CP to Mobilize: Display of available Credits de Paiement and the required mobilization for each forecasted expense.

Consumption Tracking: Monitoring of how much CP has been mobilized versus what was forecasted.

Budget Allocation & CP:

Linking Forecast to Budget: Each forecasted expense entry is linked to a specific program and budget allocation. This ensures that the forecast is realistic based on the available funds.

Tracking Mobilized CP: Real-time tracking of CP mobilized against the forecasted amounts. Alerts and notifications when the mobilization of CP is below the forecasted amounts.

G√©n√©rer des donn√©es de test

Pour les exercices 2023 et 2024 avec toutes les relations (Dashboard ‚Üí Budget ‚Üí Portefeuille ‚Üí Programme ‚Üí Action ‚Üí Op√©ration ‚Üí Engagement ‚Üí Paiement ‚Üí Demande de paiement ‚Üí Pr√©vision CP).

Injecter ces donn√©es dans Supabase

Cr√©ation de scripts SQL pour ins√©rer les donn√©es r√©elles dans la base Supabase.

Suppression de toutes les donn√©es mock√©es dans le code.

Affichage dans l‚Äôapplication

Modifier le code pour r√©cup√©rer les donn√©es depuis Supabase au lieu d‚Äôutiliser des mocks.

### **3.X. Module R√©√©valuation des Engagements**

#### üìå **Objectif :**

Permettre aux ordonnateurs et responsables budg√©taires de **formuler, suivre et justifier une demande de r√©√©valuation** sur un engagement existant, en conformit√© avec les proc√©dures de la DGB.

---

#### üß© **Fonctionnalit√©s principales :**

| Fonction                          | Description                                                               |
| --------------------------------- | ------------------------------------------------------------------------- |
| üîÅ **Cr√©er une demande**          | Permet de demander une r√©√©valuation pour un engagement valid√©             |
| üìÑ **Ajouter un justificatif**    | T√©l√©versement de documents (note de service, devis, analyse technique...) |
| üßÆ **Saisir le montant r√©√©valu√©** | Champ de saisie du nouveau montant demand√©                                |
| üìÜ **Date de r√©√©valuation**       | S√©lection automatique ou manuelle                                         |
| üóÇÔ∏è **Suivi du statut**            | En attente, approuv√©e, rejet√©e, modifi√©e                                  |
| üîê **Validation multi-niveaux**   | DAF > DG/Minist√®re > DGB selon les seuils                                 |
| üßæ **Historique des r√©visions**   | Liste chronologique des demandes et d√©cisions pr√©c√©dentes                 |

---

#### üßæ **Champs n√©cessaires (base de donn√©es)**

| Champ                   | Type     | Description                              |
| ----------------------- | -------- | ---------------------------------------- |
| `engagement_id`         | UUID     | Cl√© √©trang√®re vers l‚Äôengagement concern√© |
| `montant_initial`       | Numeric  | Montant initial de l‚Äôengagement          |
| `montant_re√©valu√©`      | Numeric  | Montant demand√© apr√®s r√©vision           |
| `motif_re√©valuation`    | Text     | Justification de la demande              |
| `document_justificatif` | File/URL | Lien vers le document t√©l√©vers√©          |
| `statut_re√©valuation`   | Enum     | En attente / Approuv√©e / Rejet√©e         |
| `date_re√©valuation`     | Date     | Date de la demande                       |
| `valid√©_par`            | Text     | Nom/fonction du validateur               |
| `date_validation`       | Date     | Date de d√©cision                         |

---

#### üß≠ **Workflow M√©tier**

```mermaid
graph TD
    A[Engagement Valid√©] --> B[Demande de R√©√©valuation]
    B --> C{Justificatif + Montant R√©√©valu√©}
    C --> D[Transmission √† la DAF]
    D --> E[Validation DGB / Autorit√©]
    E --> F{Approuv√©e / Rejet√©e}
    F --> G[Mise √† jour de l‚Äôengagement]
    F --> H[Archivage de la demande]
```

---

#### üéØ **R√¥le dans le syst√®me SIB**

- Permet une **meilleure transparence** sur l‚Äô√©volution des montants engag√©s.
- R√©pond √† la r√©alit√© du terrain o√π les co√ªts √©voluent (inflation, al√©as techniques...).
- Renforce la **tra√ßabilit√© budg√©taire** et l‚Äô√©valuation des besoins r√©els.
- Int√©gr√© aux modules :
  - **Engagements** (acc√®s via bouton ‚ÄúR√©√©valuer‚Äù)
  - **Pr√©visions CP** (mise √† jour automatique)
  - **Notifications** (workflow de validation)
  - **Audit & Logs** (tra√ßabilit√© compl√®te)

## üîß **Extension au PRD : Module Pr√©visions & Mobilisation des CP**

### üìå **Objectif**

Permettre aux utilisateurs de :

- Planifier les cr√©dits n√©cessaires au r√®glement des engagements.
- Demander officiellement la **mobilisation des CP** aupr√®s de la DGB.
- Suivre en temps r√©el l‚Äô√©volution des **CP pr√©vus, mobilis√©s et consomm√©s**.
- Anticiper les **√©carts ou retards de mobilisation**.

---

### üß© **Fonctionnalit√©s principales**

| Fonctionnalit√©                  | Description                                                                                                      |
| ------------------------------- | ---------------------------------------------------------------------------------------------------------------- |
| üìÖ **Pr√©visions p√©riodiques**   | L‚Äôutilisateur saisit les pr√©visions CP par programme ou op√©ration, avec une r√©partition mensuelle/trimestrielle. |
| üßæ **Demande de mobilisation**  | Formulaire d√©di√© pour transmettre √† la DGB une demande de mise √† disposition des CP.                             |
| üîÑ **Suivi de la mobilisation** | Affiche les montants mobilis√©s vs montants pr√©vus avec visualisation des √©carts.                                 |
| üìä **Tableaux & Graphiques**    | Vue synth√©tique avec filtres (minist√®re, programme, p√©riode, statut).                                            |
| üîî **Alertes automatiques**     | Notifie l‚Äôutilisateur si les montants mobilis√©s sont en retard ou inf√©rieurs aux besoins.                        |

---

### üßæ **Champs de la table `prevision_cp` √©tendue**

| Champ              | Type    | Description                                                           |
| ------------------ | ------- | --------------------------------------------------------------------- |
| `id`               | UUID    | Identifiant unique                                                    |
| `programme_id`     | UUID    | Cl√© √©trang√®re vers le programme concern√©                              |
| `exercice`         | INT     | Ann√©e concern√©e                                                       |
| `periode`          | VARCHAR | Mois ou trimestre (ex: `2024-Q1`)                                     |
| `montant_prevu`    | DECIMAL | Montant pr√©vu de CP                                                   |
| `montant_demande`  | DECIMAL | Montant de CP demand√© √† la DGB                                        |
| `montant_mobilise` | DECIMAL | Montant effectivement mobilis√©                                        |
| `montant_consomme` | DECIMAL | Montant pay√© sur les CP mobilis√©s                                     |
| `statut`           | ENUM    | `pr√©vu`, `demand√©`, `mobilis√©`, `en retard`, `partiellement mobilis√©` |
| `date_soumission`  | DATE    | Date d‚Äôenvoi de la demande de mobilisation                            |
| `notes`            | TEXT    | Commentaires ou pr√©cisions                                            |

---

### üîÅ **Workflow de Mobilisation des CP**

```mermaid
graph TD
    A[Pr√©vision CP par Programme] --> B[Demande de mobilisation envoy√©e]
    B --> C[R√©ception par DGB]
    C --> D{Montant disponible ?}
    D -- Oui --> E[CP Mobilis√©s]
    D -- Non --> F[Notification de refus/ajustement]
    E --> G[Mise √† jour du tableau des CP]
    G --> H[Engagement pay√© via Paiement]
```

---

### üìà **√âcrans propos√©s dans l‚Äôapplication**

#### üîç **Vue Liste Pr√©visions CP**

- Filtres : Exercice, Minist√®re, Programme, P√©riode, Statut
- Colonnes : Exercice | Programme | P√©riode | Montant pr√©vu | Mobilis√© | Consomm√© | √âcart

#### üìù **Formulaire de Demande de Mobilisation**

- Programme (auto rempli)
- Montant demand√©
- P√©riode concern√©e
- Justificatif √† joindre (optionnel)
- Bouton ‚ÄúSoumettre √† la DGB‚Äù

#### üìä **Graphique de Suivi CP**

- Ligne : CP Pr√©vu
- Barre : CP Mobilis√©
- Ligne pointill√©e : CP Consomm√©

---

### üîê **R√¥les utilisateurs impliqu√©s**

| R√¥le        | Droits sp√©cifiques                               |
| ----------- | ------------------------------------------------ |
| Ordonnateur | Cr√©er une pr√©vision, soumettre une demande de CP |
| DAF         | Valider les demandes avant transmission          |
| DGB         | Mobiliser les CP, modifier les montants          |
| Auditeur    | Lire toutes les lignes CP et leurs statuts       |

Nouveaux champs sugg√©r√©s par les fichiers
wilaya : utile pour la r√©partition g√©ographique

code, code_action, code_operation

titre_budgetaire (titre 1, 2, 3, 4)

statut_demande : En attente / Valid√©e / Rejet√©e

origine_financement : Budget national / Financement externe

üéØ 5. Finalit√© m√©tier align√©e avec la LOLF
Centralisation des projets budg√©taires multi-minist√®res

Tra√ßabilit√© de l'ex√©cution de la ligne budg√©taire jusqu'au paiement

Suivi multi-niveaux et analytique (par wilaya, secteur, programme)

Contr√¥le de la mobilisation et consommation des CP (cr√©dits de paiement)

### **4.X. Historique de modifications et tra√ßabilit√©**

Afin de garantir une **tra√ßabilit√© compl√®te des actions budg√©taires** conform√©ment aux exigences de la LOLF, le syst√®me SIB doit enregistrer **l‚Äôensemble des modifications appliqu√©es** aux entit√©s financi√®res sensibles (engagements, pr√©visions, paiements...).

#### üîÅ Historique des r√©√©valuations :

- Chaque engagement peut faire l‚Äôobjet de **plusieurs r√©√©valuations successives**.
- Le syst√®me doit conserver :
  - Le **montant initial**
  - Chaque **demande de r√©√©valuation** (avec date, motif, montant propos√©, validation)
  - L‚Äô**auteur** de la demande et le **d√©cideur**
- Chaque modification sera historis√©e avec un **horodatage** clair et une **signature fonctionnelle** (ex. DAF, DG, DGB).

#### üßæ Journal des modifications (Audit Log) :

- Applicable √† : Engagements, Paiements, Pr√©visions CP, Demandes de CP
- Contenu :
  - Avant / apr√®s des champs modifi√©s
  - Utilisateur initiateur
  - Date et heure de l‚Äôop√©ration
  - Justificatif (si requis)

üéØ Cela renforce :

- La **transparence administrative**
- Le **contr√¥le a posteriori** par la DGB, IGF ou Cour des Comptes
- La capacit√© de **justifier les √©carts financiers**

### **4.X. Donn√©es manquantes et optimisations √† int√©grer**

L‚Äôanalyse des fichiers budg√©taires r√©els a permis d‚Äôidentifier plusieurs **champs essentiels non encore pris en compte** dans le syst√®me SIB actuel. Leur ajout est indispensable pour assurer une **tra√ßabilit√© compl√®te**, une **analyse plus fine**, et une **conformit√© accrue avec la LOLF**.

#### üßæ Champs √† ajouter :

- `wilaya` : localisation g√©ographique du projet ou de l‚Äôop√©ration.
- `code`, `code_action`, `code_operation` : identification uniforme des entit√©s budg√©taires.
- `titre_budgetaire` : classification par titre (1 : fonctionnement, 2 : √©quipement, etc.).
- `statut_demande` : √©tat d'avancement d‚Äôune demande (En attente / Valid√©e / Rejet√©e).
- `origine_financement` : source (Budget national / Financement ext√©rieur).

#### üéØ Finalit√© m√©tier align√©e avec la LOLF :

- Centralisation multi-niveaux des projets budg√©taires.
- Tra√ßabilit√© compl√®te de l‚Äôex√©cution du budget jusqu‚Äôau paiement.
- Suivi analytique par structure, secteur et r√©gion.
- Contr√¥le rigoureux de la mobilisation et consommation des **cr√©dits de paiement (CP)**.

### üìò **Classification par titres budg√©taires (titre_budgetaire)**

| Titre | Intitul√©                                | Description principale                                   |
| ----- | --------------------------------------- | -------------------------------------------------------- |
| 1     | **D√©penses de fonctionnement**          | D√©penses courantes (salaires, loyers, fournitures, etc.) |
| 2     | **D√©penses d‚Äô√©quipement public**        | Investissements de l‚Äô√âtat (infrastructures, mat√©riel‚Ä¶)   |
| 3     | **D√©penses en capital (ou transferts)** | Subventions d‚Äô√©quipement, avances, transferts de capital |
| 4     | **Charge de la dette publique**         | Remboursement du principal et paiement des int√©r√™ts      |
| 5     | **D√©penses exceptionnelles**            | Cat√©gorie sp√©ciale pour √©v√©nements ou d√©penses impr√©vues |

---

### üìù Remarques :

- Les titres **1 et 2** sont les plus fr√©quemment utilis√©s au niveau des **engagements et paiements minist√©riels**.
- Les titres **3 et 4** sont g√©r√©s plus centralement (Tr√©sor, Finances).
- Certains documents parlent uniquement de **Titres 1 √† 3**, selon le p√©rim√®tre de l'institution.
